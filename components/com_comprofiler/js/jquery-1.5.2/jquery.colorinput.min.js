/*
Color Input for jQuery
Copyright (c) 2008 Anthony Johnston
http://www.antix.co.uk
http://code.google.com/p/jquery-colorinput/
        
version 1.0.0
*/(function(a){function c(a){var b=["<div class='hueMap' style='position:absolute;z-index:0;width:",a.hueWidth,"px;height:",a.cells*a.cellSize,"px'>"];for(var c=0;c<a.cells*a.cellSize;c++)b.push("<div style='float:left;position:relative;overflow:hidden;width:",a.hueWidth,"px;height:1px;border:none 0'>&nbsp;</div>");b.push("</div>");return b.join("")}function b(a){var b=["<div class='saturationBrightnessMap' style='position:absolute;z-index:1;overflow:hidden;width:",a.cells*a.cellSize,"px;height:",a.cells*a.cellSize,"px'>"];for(var c=0;c<a.cells;c++)for(var d=0;d<a.cells;d++)b.push("<div ".concat("style='float:left;overflow:hidden;width:",a.cellSize,"px;height:",a.cellSize,"px;border:none 0'></div>"));b.push("</div>");return b.join("")}a.fn.colorInput=function(b){b=jQuery.extend(a.colorInput.defaults,b),this.each(function(){a(this).data("colorControl",new a.colorInput(this,b))});return this},a.fn.colorSelected=function(a){if(a){this.bind("colorSelected",a);return this}this.trigger("colorSelected")},a.fn.colorAccept=function(a){if(a){this.bind("colorAccept",a);return this}this.trigger("colorAccept")},a.fn.colorCancel=function(a){if(a){this.bind("colorCancel",a);return this}this.trigger("colorCancel")},a.colorInput=function(d,e){var f=a(d);if(f.data("colorControl")!=null)return this;var g=this,h=e.cells*e.cellSize,i=e.cells*e.cellSize+e.hueWidth,j="<button ".concat("class='colorButton' style='width:",e.hueWidth,"px;height:",e.hueWidth,"px;margin:0;padding:0;border:none 0;line-height:",e.hueWidth-2,"px'>&nbsp;</button>"),k=a(j),l,m,n;f.after(k),k.click(function(b){a.colorInput.current==g?z():a.colorInput.current?a.colorInput.current.cancel():C(),b.stopPropagation();return!1});var o=a("#".concat(e.dropdownId));o.length==1?e.acceptCancelButtons&&(l=o.find(".colorButtons"),m=l.find(":eq(0)"),n=l.find(":eq(1)")):(o=a("<div ".concat("id='",e.dropdownId,"' class='colorDropdown' style='display:none;position:absolute;overflow:visible;height:0;margin:0;padding:0;cursor:pointer'></div>")).append(a("<div ".concat("style='float:left;width:",h,"px;height:",h,"px;margin:0;padding:0'></div>")).append(c(e)).append(b(e))),e.acceptCancelButtons&&(m=a(j).text(e.textAccept).css({width:Math.round(h/2)}),n=a(j).text(e.textCancel).css({width:Math.round(h/2)}),l=a("<div ".concat("class='colorButtons' style='position:absolute;z-index:0;left:0;width:",h,"px;height:",e.hueWidth,"px'></div>")).append(m).append(n),o.prepend(l)),a(document.body).append(o));var p=o.find(".saturationBrightnessMap"),q=o.find(".hueMap"),r=new a.colorInput.color,s,t,u=!1;e.hideInput&&f.hide();var v,w=function(b){v&&(clearTimeout(v),v=null);if(b)v=setTimeout(w,b);else{var c=r.hue*h-Math.round(r.hue*h),d=new a.colorInput.color(0,1,1);G(null),q.find("div").each(function(){d.hue=c/h,this.hue=d.hue,this.color=d.toHex(),this.style.backgroundColor=this.color,this.hue==r.hue&&G(this),c++});var f=0,g=0;d=new a.colorInput.color(r.hue,0,0),I(null),p.find("div").each(function(){d.saturation=1-f/(e.cells-1),d.brightness=1-g/(e.cells-1),this.saturation=d.saturation,this.brightness=d.brightness,this.color=d.toHex(),this.style.backgroundColor=this.color,this.color==s&&I(this),f++,f==e.cells&&(f=0,g++)})}},x=function(){var a=f.val();a=a[0]!="#"?"#".concat(a):a,a!=s&&(r.fromHex(a),y(a,u))},y=function(a,b){s=a,f.val(a[0]=="#"&&e.noHash?a.slice(1):a),g.isChanged=t&&s!=t,k.css({backgroundColor:a,color:r.brightnessContrast().toHex()}),e.acceptCancelButtons&&m.css({backgroundColor:a,color:r.brightnessContrast().toHex()}),b&&w(e.hoverSelect?50:0)},z=function(){t!=s&&f.change(),t=null,B()},A=function(){g.isChanged&&(f.val(t),x(),f.colorSelected()),t=null,B()},B=function(){a.each(e.cancelOnClick,function(){a(this).unbind("click.color")}),q.find("div").unbind("mousedown").unbind("mousemove").unbind("mouseup").unbind("click"),p.find("div").unbind("mousedown").unbind("mousemove").unbind("mouseup").unbind("click"),p.unbind("dblclick"),o.unbind("click"),e.acceptCancelButtons&&(l.animate({marginTop:0},{duration:125}),m.unbind("click"),n.unbind("click")),q.animate({marginLeft:h-e.hueWidth},{duration:125,complete:function(){q.css({display:"none"}),o.animate({height:0,width:0},{duration:250,complete:function(){o.css({display:"none"})}})}}),a.colorInput.current=null,g.isChanged=!1,u=!1},C=function(){t=s,e.acceptCancelButtons&&m.add(n).css({backgroundColor:s,color:r.brightnessContrast().toHex()}),w(),a.each(e.cancelOnClick,function(){a(this).bind("click.color",A)}),e.hoverSelect?(q.find("div").mousemove(function(a){H(this),f.colorSelected()}),p.find("div").mousemove(function(a){J(this),f.colorSelected()}),p.dblclick(function(a){z(),a.stopPropagation();return!1}),p.click(function(a){z(),a.stopPropagation();return!1})):(q.find("div").mousedown(function(a){return D(a,q)}).mousemove(function(a){F(a,q)&&(H(this),f.colorSelected())}).mouseup(function(a){E(a,q)}).click(function(a){H(this),f.colorSelected()}),p.find("div").mousedown(function(a){return D(a,p)}).mousemove(function(a){F(a,p)&&(J(this),f.colorSelected())}).mouseup(function(a){E(a,p)}).click(function(a){J(this),f.colorSelected()}),p.dblclick(function(a){z(),a.stopPropagation();return!1})),o.click(function(a){a.stopPropagation();return!1});var b=k.offset();o.css({display:"",top:b.top+k.height()+"px",left:b.left+(e.showLeft?-h:0)+"px"}).animate({height:h,width:h},{duration:500,complete:function(){q.css({display:""}).animate({marginLeft:h},{duration:250}),e.acceptCancelButtons&&(l.animate({marginTop:-e.hueWidth},{duration:250}),m.click(function(a){z(),a.stopPropagation();return!1}),n.click(function(a){A(),a.stopPropagation();return!1}))}}),a.colorInput.current=g,u=!0};a.browser.msie&&(o.attr("unselectable","on"),o.find("div").attr("unselectable","on"));var D=function(a,b){b.data("drag")&&E(a,b),b.data("drag",!0);return!1},E=function(a,b){b.data("drag",!1)},F=function(b,c){if(!c.data("drag"))return!1;if(a.browser.msie&&!b.button){E(b,c);return!1}return!0},G=function(a){var b=q.data("selected");b&&(b.style.zIndex=0,b.style.width=e.hueWidth+"px",b.style.margin="0",b.style.border="none 0"),q.data("selected",a),a&&(a.style.zIndex=1,a.style.width=e.hueWidth-2+"px",a.style.margin="-1px 0",a.style.border="solid 1px #000")},H=function(a){r.hue=a.hue,y(r.toHex(),u)},I=function(a){var b=p.data("selected");b&&(b.style.width=e.cellSize+"px",b.style.height=e.cellSize+"px",b.style.border="none 0"),p.data("selected",a),a&&(a.style.width=e.cellSize-2+"px",a.style.height=e.cellSize-2+"px",a.style.border="solid 1px ".concat(r.brightnessContrast().toHex()))},J=function(a){r.saturation=a.saturation,r.brightness=a.brightness,y(r.toHex(),!1),I(a)};f.bind("change",x),f.bind("colorAccept",z),f.bind("colorCancel",A),e.change&&f.change(e.change),e.colorSelected&&f.colorSelected(e.colorSelected),this.accept=z,this.cancel=A,this.isChanged=!1,x();return this},a.colorInput.defaults={acceptCancelButtons:!0,cancelOnClick:[document],cells:15,cellSize:10,change:null,colorSelected:null,dropdownId:"ColorDropdown",hideInput:!0,hoverSelect:!1,hueWidth:20,noHash:!1,showLeft:!1,textAccept:"ok",textCancel:"cancel"},a.colorInput.current=null,a.colorInput.color=function(b,c,d){arguments.length==1&&b.constructor==String?this.fromHex(b):(this.hue=parseFloat(b)||0,this.saturation=parseFloat(c)||0,this.brightness=parseFloat(d)||0),this.isValid=function(){if(isNaN(this.hue))return!1;while(this.hue>1)this.hue-=1;while(this.hue<0)this.hue+=1;if(isNaN(this.saturation))return!1;this.saturation>1?this.saturation=1:this.saturation<0&&(this.saturation=0);if(isNaN(this.brightness))return!1;this.brightness>1?this.brightness=1:this.brightness<0&&(this.brightness=0);return!0},this.isValid(),this.brightnessContrast=function(){return new a.colorInput.color(0,0,this.brightness>=.75?0:1)},this.valueToHex=function(a){var b=Math.round(a*255).toString(16);return b.length==1?"0"+b:b},this.hexToValue=function(a){return parseInt(a,16)/255},this.fromHex=function(a){a.slice(0,1)=="#"&&(a=a.slice(1)),a.length==3&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);if(a.length!=6)this.brightness=NaN;else{var b=this.hexToValue(a.substr(0,2)),c=this.hexToValue(a.substr(2,2)),d=this.hexToValue(a.substr(4,2));this.brightness=Math.max(Math.max(b,c),d);var e=Math.min(Math.min(b,c),d);if(e==this.brightness)this.hue=0,this.saturation=0;else{var f=this.brightness-e;this.saturation=f/this.brightness,b==this.brightness?this.hue=(c-d)/f:c==this.brightness?this.hue=2+(d-b)/f:this.hue=4+(b-c)/f,this.hue/=6,this.hue<0&&(this.hue+=1),this.hue>1&&(this.hue-=1)}return this}},this.toHex=function(a){if(!this.isValid())return"Transparent";var b,c,d,e=Math.floor(this.hue*6),f=this.hue*6-e,g=this.brightness*(1-this.saturation),h=this.brightness*(1-this.saturation*f),i=this.brightness*(1-this.saturation*(1-f));switch(e){case 1:b=h,c=this.brightness,d=g;break;case 2:b=g,c=this.brightness,d=i;break;case 3:b=g,c=h,d=this.brightness;break;case 4:b=i,c=g,d=this.brightness;break;case 5:b=this.brightness,c=g,d=h;break;case 6:case 0:b=this.brightness,c=i,d=g}return a?"":"#"+this.valueToHex(b)+this.valueToHex(c)+this.valueToHex(d)}}})(jQuery)